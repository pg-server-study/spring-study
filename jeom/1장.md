#  1 .  스프링 IOC 와 DI 

>일단 사용자 정보를 jdbc api를 통해 db에 저장하고 조회할수 있는 dao를 만들어보자.

> 예시코드 ( User clas 생략 )

```java
public class UserDao{
	public void add(User user) throws ClassNotFoundExcetion,SQLException {
        // 사용자 정보를 생성하는 메소드 
		Class.forName("com.mysql.jdbc.Driver");
        Connciton c = DriverManger.getConnection(
            	"jdbc:mysq://localhost/springbook","spring","book";
        	);
        PreparedStatement ps = c.prepareStatement(
            	"insert into users(id, name , password) values(?,?,?)";
        );
        
        ps.setString(1,user.getId());
        ps.setString(1,user.getName());
        ps.setString(1,user.getPassword());
        
        ps.excuteUpdate();
        
        ps.close();
        c.close();
	}
    
    public User get(String id) throws ClassNotFoundExcetion,SQLException {
        // 사용자 정보를 가져오는 메소드 
		Class.forName("com.mysql.jdbc.Driver");
        Connciton c = DriverManger.getConnection(
            	"jdbc:mysq://localhost/springbook","spring","book";
        	);
        PreparedStatement ps = c.prepareStatement(
            	"insert into users(id, name , password) values(?,?,?)";
        );
        
       ps.setStirng(1,id);
       
       ResultSet re = ps.executeQuery();
       rs.next();
       User user = new User();
       user.setId(rs.getString("id"));
       user.setName(rs.getString("name"));
       user.setPassword(rs.getString("password"));
        
       rs.close();
       ps.close();
       c.close();
        
       return user;
	}
}
```

>기능에는 전혀문제가 없겠지만 유지 , 보수 , 확장하기 어려운 **초난감 Dao가 완성 되었다 . **
>
>이제 초난감한 Dao를 개선해보자 .



>**관심사 분리 **

> 현재 초난감 dao 에서 기능 변경이 있을경우 **어떻게 필요한 최소한 작업을 최소화 하고 , 변경이 문제를 일으키지 않게** 할수 있을까 ?
>
> 위에 초난감 Dao에서 db 암호를 바꾸려면 ? Dao 클래스가 많을수록 그 많은 클래스들을 전부 수정해야한다.
>
> 프로그래밍 기초 개념중에 **관심사의 분리 **라는게 있다 . 이를 객체 지향에 적용해 보면 ,
>
> 관심이 같은 것끼리는 하나의 객체안으로 또는 친한 객체로 모이게 하고 ,
>
> 관심이 다른것 끼리는 가능한 따로 떨어져서로 영향을 주지 않도록 분리하는것이라 생각 해볼수 있다 .



> **UserDao의 관심사항 **

- db연결을 위한 커넥션을 어떻게 가져올지
- 사용자 등록을 위해 db에 보낼 sql 문장을 담을 Statement를 만들고 실행하는것
- 작업이 끝나면 리소스인 Statemane 와  Connection 오브젝트를 닫아주는것.

> **가장 문제가 되는건 db 커넥션을 가져오는 부분이다** . 앞으로 여러개 , 수백개의 dao 클래스를 만들면 db커넥션을 가져오는 코드도 수백개가 되어 버릴것이다 . 



> 중복 코드의 메소드 추출 

```java
public void add(User user) throws ClassNotFoundExctption,SPLExcetion{
	Connection c = getConnection();
	... //생략
}
public User get(String id) throws ClassNotFoundExctption,SPLExcetion{
	Connection c = getConnection();
	... //생략
}
private Connection getConnection() throws ClassNotFoundExctption,SPLExcetion {
   Class.forName("com.mysql.jdbc.Driver");
        Connciton c = DriverManger.getConnection(
            	"jdbc:mysq://localhost/springbook","spring","book";
        	);
    return c;
}
```

> 나중에 db연결 부분에 변경이 일어 났을 경우 , getConnection 메소드만 수정해 주면 된다 .



> **db 커넥션 만들기의 독립 **
>
> 슈퍼 울트라 캡숑  dao가 되어 버려서 구매하고 싶다는 회사에 납품을 하려한다 .
>
> 하지만 n사와 d사와 각기 다른 종류의 db를 사용하고 db 커넥션을 가져오는데 독자적인 방법으로 적용 하고 싶어 한다는 문제가 생겼다 . 더 큰문제는 db커넥션을 가져오는 방법이 종종 변경 될 가능성이 있다는점 !
>
> 슈퍼 울트라 캡숑 UserDao 소스코드를 공개하고 알아서 수정하라 할 수 있지만,
>
> 어떻게 하면 **울트라 캡숑 기술을 공개하고 싶지않으면서 고객스스로 원하는 db 커네션 생성 방식을 사용하게 할수있을까**?



> **상속을 통한 확장**
>
> 기존 UserDao 코드를 한단계더 분리한다 . 
>
> UserDao에서 구현 코드를 제거하고 getConnection()을 추상메소드로 만든다.
>
> -> 따라서 add() , get() 메소드에서 getConnection() 을 호출하는 코드는 그대로 유지할수 있다 .



> **상속을 통해 관심을 분리하고 변신이 가능하도록 확장성도 줬지만 문제점이 있다 **

- 자바는 다중 상속을 허용하지 않기때문에 나중에 다른이유로 UserDao에 상속을 하기 어렵다 .
- 서브클래스는 슈퍼클래스의 기능을 직접 사용 할수 있기 때문에 , 슈퍼 클래스 내부의 변경이 있을경우 모든 서브클래스를 함께 수정하거나 다시 개발해야할수도 있음
- 확장 기능인 db 커넥션을생성하는 코드를 다른 Dao 클래스에 적용할수 없다 . ( 다른 Dao 클래스들이 계속만들어 진다면 상속을 통해 만들어진  getConnection() 의 구현 코드가 매 Dao 클래스마다 중복됨  )

> 수정된 코드  

```java
public class DConnectionMaker implements ConnectionMaker{
	public Conneciton makeConnection() throws ClassNotFoundException , SQLException{
			// Connetction 을 생성하는 코드 
	}
}
```

```java
public class UserDao{
	private ConnectionMaker connecitonMaker;
    //인터페이스를 통해 오브제트에 접근 하므로 구체적인 프로젝트 정보를 알 필요가 없다 .
	
	public UserDao(){
		connectionMaker = new DConnectionMaker();
        // 근데 여기는 클래스 이름이 나오네 ;
	}
	
	public void add(User user) throws lassNotFoundException, SQLException{
		Connection c = connectionMaker.makeConnection();
		...
        //인터에이스에 정의 된 메소드를 사용하므로 클래스가 바뀐다고 해도 이름이 변경될 걱정 x 
	}
}
```

>인터페이스를 사용해 초기 코드에서 클래스를 분리 ,
>
>자신을 구현한 클래스에 대한 구체적인 정보는 감춰버림
>
>-> 오브젝트를 만들면 구체적인 클래스 하나를 선택해야 겠지만 , 
>
>인터페이스로 추상화 해놓은 최소한의 통로를 통해 접근하는 쪽에서는 
>
>**사용할 클래스가 무엇인지 몰라도된다 **.
>
>**인터페이스를 통해 접근하게 하면 실제 구현 클래스를 바꾸어도 신경쓸 일이없다.**

